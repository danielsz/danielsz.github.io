---
permalink: /searching-for-files-on-your-computer/index.html
layout: post
title: Searching for files on your computer
published: true
categories:
- finding files
- locating files
- unix
- unix culture
- unix history
---
<p class="p1">Here's a&nbsp;one-line&nbsp;story: a&nbsp;client told me he had just installed a program, but couldn't find its configuration files.</p>
<p class="p1"><a href="http://en.wikipedia.org/wiki/POSIX" title="POSIX" target="_blank">POSIX</a>-compliant systems come with two utilities that at first sight do the same thing, <em>find</em> and <em>locate</em>.&nbsp;Their semantical similitude will&nbsp;trip over most new shell users&nbsp;at one point or another. When their difference is not well understood, the tendency is to pick one on a whim, and then be startled at the results.&nbsp;</p>
<p class="p2">What tool was my client using to locate his files? Right, <em>locate</em>. Why&nbsp;couldn't&nbsp;<em>locate</em>&nbsp;find them? Well, <em>locate</em> is a utility that queries a lookup table that gets&nbsp;updated periodically. On a Mac, the interval is set to once a week. No wonder it can't find recent files!&nbsp;If you insist, you can force <em>locate</em> to update its database (on a Mac you would run <em>/usr/libexec/locate.updatedb</em>). But guess what? <em>locate</em> still won't find my client's files. The reason for this is that <em>locate</em> only indexes world-readable files,&nbsp;and it just so happens that my client's&nbsp;configuration files were installed in a user-only readable directory, as they should be.&nbsp;</p>
<p class="p2">Why can <em>locate</em> access only a restricted set of files? Because <em>locate</em> runs under the unprivileged account of special user <em>nobody</em>, to which only files with permissions set to user <em>nobody</em>, group <em>nobody</em>, or <em>world</em> is visible.&nbsp;Is <em>locate</em> useful at all then? Sure, it is fast, as in super fast--an optimized table lookup. What about the restrictions related to file permissions? Well,&nbsp;remember that&nbsp;on most POSIX systems&nbsp;files are world-readable by default (yes, your home directory too, and if you're on a multi-user system, you might want to change that right now with <em>chmod -R 750 /</em>). So if it's true that&nbsp;<em>locate</em> won't find all of your files on your system, it will find most of them.</p>
<p class="p2">Now, contrast <em>locate</em> to <em>find</em>, a utility that recursively descends a directory tree with powerful pattern matching capabilities. Its operation is expensive and will take some time to complete, but your file will be found no matter what.&nbsp;To find a file&nbsp;by name&nbsp;that can be anywhere on the filesystem, you would type <em>find / -name 'filename'</em>.&nbsp;</p>
<p class="p2">With this understanding, you know now how to proceed when looking for files. Start off with a lightning speed <em>locate</em>, and if it fails, don't panic, just switch to a <em>find</em> command. And if you're on a Mac and you find yourself doing this often, you might want to update your precomputed database more than once a week, say every day.&nbsp;</p>
<p>In terminal, type:</p>
<div class="CodeRay"><div class="code"><pre>open /System/Library/LaunchDaemons/com.apple.locate.plist</pre></div></div>
<p class="p2">Find the&nbsp;<em>StartCalendarInterval</em>&nbsp;section and delete the <em>Weekday</em> key:</p>
<script src="https://gist.github.com/3107243.js?file=com.apple.locate.plist"></script>
<p class="p2">Afraid of breaking something? Fear not: validate your changes with:</p>
<div class="CodeRay"><div class="code"><pre>plutil /System/Library/LaunchDaemons/com.apple.locate.plist</pre></div></div>
<p class="p2">The output confirms your plist is valid:</p>
<div class="CodeRay"><div class="code"><pre>/System/Library/LaunchDaemons/com.apple.locate.plist: OK</pre></div></div>
<p class="p1">The practical tips are all packed in the above paragraphs. We are now embarking on a short UNIX archeological journey replete with geeky miscellanea. The first thing to note is that&nbsp;<em>find</em> is actually what <em>locate</em> uses internally when building its database on schedule. If you suspect some&nbsp;promiscuity between the two, you'd be right on spot: <em>locate</em> was born out of <em>find</em>. It was initially called <em>fastfind</em>, and it was a refinement that James A. Woods introduced in the standard <em>find</em> shipping with Berkeley UNIX (BSD). His ideas are laid out in a paper called <a href="http://www.eecs.berkeley.edu/Pubs/TechRpts/1983/5392.html" title="Finding Files Fast" target="_blank">Finding Files&nbsp;Fast</a>.&nbsp;Interestingly, he thought there was no need to introduce a new tool (and a new man page), arguing it would be wiser to leverage the existing <em>find, </em>supercharging it with&nbsp;a fast mode. If you ran <em>find</em> with two arguments, it would run as before, traversing the filesystem, but if you gave it only one argument (the search string), it would query a precomputed database, dramatically speeding up the operation. Note also that in his mind, the database would get updated on a daily basis.&nbsp;For the hardcore UNIX archeologists among you, the <a href="http://www.retro11.de/ouxr/211bsd/usr/src/usr.bin/find/find.c.html" title="Find, source code" target="_blank">source code</a> can be perused online, with the <em>fastfind</em> section starting on line 797.&nbsp;</p>
<p class="p1">The result of this change was that&nbsp;the signature of the <em>find</em> command became ambiguous and broke POSIX requirements.&nbsp;Suddenly<strong>, </strong><em>find&nbsp;foo</em> was not equivalent anymore to <em>find foo -print</em>. In the first form, it would query the database, in the second form, it would not. So in a later version of Berkeley UNIX (BSD), the <em>findfast</em> part of <em>find</em> was extracted and made into&nbsp;a separate utility: <em>locate</em>. The GNU distribution did likewise in the package that encloses <em>find</em>, <em>xargs</em>, and <em>locate</em> (<a href="http://www.gnu.org/software/findutils/" title="GNU findutils" target="_blank">findutils</a>).&nbsp;</p>
<p class="p1">The <a href="http://m.simson.net/ugh.pdf" title="UNIX-HATERS handbook" target="_blank">UNIX-HATERS handbook</a> correctly points out that&nbsp;<em>find</em> wasn&rsquo;t designed to work with humans, but as a companion utility to <em>cpio</em>&mdash;a Unix backup utility program. Both utilities were written by Dick Haight while working in AT&amp;T's Unix Support Group, appearing in 1977 in PWB/UNIX 1.0, the "Programmer's Work Bench" system for use within AT&amp;T.&nbsp;It was first&nbsp;released outside of AT&amp;T as part of System III Unix in 1981.&nbsp;In the early days, its peculiarities<strong>&nbsp;</strong>aggravated some UNIX users, <a href="http://doc.cat-v.org/unix/find-history" title="The History of the Design of Unix's Find Command" target="_blank">complaining</a> about the seemingly useless <em>-print</em> option, or lamenting the fact that it didn't support symlinks (for a certain period), etc. Today, most issues with <em>find</em> have been addressed, but reading its man page is still a panacea for none but die-hard UNIX hackers. For the rest of us,&nbsp;<a href="http://find.unixpin.com/" title="Find UI" target="_blank">a web interface</a>&nbsp;can come handy in those instances when we want to leverage <em>find's</em> full power. Most of the time though, all that is needed to remember is:</p>
<div class="CodeRay"><div class="code"><pre>find &lt;directory&gt; -name &lt;filename&gt;</pre></div></div>
